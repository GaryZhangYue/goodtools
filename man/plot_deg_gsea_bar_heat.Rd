% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/plot_deg_gsea_bar_heat.R
\name{plot_deg_gsea_bar_heat}
\alias{plot_deg_gsea_bar_heat}
\title{Plot DEG barplot with pathway-membership dot-heatmap (GSEA leading-edge)}
\usage{
plot_deg_gsea_bar_heat(
  df_gsea,
  df_deg,
  contrast,
  cluster,
  col_contrast = "Contrast",
  col_cluster = "Cluster",
  col_pathway = "Pathway",
  col_leading = "leadingEdge",
  col_gene = "Gene",
  col_lfc = "lfc",
  col_padj_cat = "padj_cat",
  legend_position = "top",
  legend_direction = "horizontal",
  heat_colors = c(`0` = "white", `1` = "lightblue"),
  circle_size = 2.5,
  heights = c(1, 2),
  x_text_angle = 90,
  x_text_size = 7,
  pathway_text_size = 8,
  ...,
  bar_add = list(),
  heat_add = list()
)
}
\arguments{
\item{df_gsea}{Unnested GSEA results table. Must include columns for contrast, cluster,
pathway, and a list-column of leading-edge genes (e.g. \code{leadingEdge}).}

\item{df_deg}{DEG table. Must include gene, contrast, log fold-change, and \code{padj_cat}.
\code{padj_cat} should be computed outside this function.}

\item{contrast}{Character scalar. Which contrast to plot.}

\item{cluster}{Character scalar. Which cluster to plot (matched as character).}

\item{col_contrast}{Column name for contrast in both tables (default \code{"Contrast"}).}

\item{col_cluster}{Column name for cluster in \code{df_gsea} (default \code{"Cluster"}).}

\item{col_pathway}{Column name for pathway (default \code{"Pathway"}).}

\item{col_leading}{Column name for leading-edge list-column (default \code{"leadingEdge"}).}

\item{col_gene}{Column name for gene (default \code{"Gene"}).}

\item{col_lfc}{Column name for log fold-change in \code{df_deg} (default \code{"lfc"}).}

\item{col_padj_cat}{Column name for padj category in \code{df_deg} (default \code{"padj_cat"}).}

\item{legend_position}{Legend position for barplot (default \code{"top"}).}

\item{legend_direction}{Legend direction for barplot (default \code{"horizontal"}).}

\item{heat_colors}{Named character vector for membership colors with names \code{"0"} and \code{"1"}
(default \code{c(`0`="white", `1`="lightblue")}).}

\item{circle_size}{Numeric; size of membership circles in the heatmap (default 2.5).}

\item{heights}{Numeric length-2 vector for patchwork layout heights (default \code{c(1,2)}).}

\item{x_text_angle}{Angle for barplot x labels (default 90).}

\item{x_text_size}{Size for barplot x labels (default 7).}

\item{pathway_text_size}{Size for pathway labels (right side) (default 8).}

\item{...}{Additional ggplot components (e.g. \code{theme()}, \code{scale_*()}, \code{guides()})
that will be added to BOTH plots.}

\item{bar_add}{A list of ggplot components to add only to the barplot (default \code{list()}).}

\item{heat_add}{A list of ggplot components to add only to the heatmap (default \code{list()}).}
}
\value{
A list with elements:
\itemize{
\item \code{plot}: patchwork combined plot
\item \code{p_bar}: barplot ggplot
\item \code{p_heat}: heatmap ggplot
\item \code{bar_df}: data used for barplot
\item \code{heat_df}: data used for heatmap
\item \code{gene_freq_deg}: merged gene frequency + DEG stats
}
}
\description{
For a given Contrast × cluster, this function:
\enumerate{
\item counts how many pathways each gene appears in (from GSEA leadingEdge),
\item merges in DEG log fold-change (lfc) and a precomputed padj category (padj_cat),
\item draws a faceted barplot (facet = n_pathways, ordered high → low),
\item draws a pathway-membership "dot heatmap" aligned underneath (binary present/absent).
}
}
\details{
The heatmap panel is rendered as a grid of white tiles (for alignment) with colored circles
indicating membership in each pathway. The bar/heatmap facets share the same ordering.

Users can further customize plots by providing ggplot components via:
\itemize{
\item \code{...}: applied to BOTH \code{p_bar} and \code{p_heat}
\item \code{bar_add}: applied only to \code{p_bar}
\item \code{heat_add}: applied only to \code{p_heat}
}
}
\examples{
\dontrun{
# df_deg must already contain padj_cat
res <- plot_deg_gsea_bar_heat(
  df_gsea   = df.tmp.unnested,
  df_deg    = df.deg2,
  contrast  = "Classical Monocytes",
  cluster   = "1",
  circle_size = 3,
  bar_add  = list(ggplot2::theme(legend.position = "bottom")),
  heat_add = list(ggplot2::theme(axis.text.y.right = ggplot2::element_text(size = 10)))
)
res$plot
}

}
